<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>მონაცემების ძიება</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  input[type="text"] { width: 300px; padding: 8px; margin-bottom: 10px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  tr:hover { background-color: #f5f5f5; }
  img { max-width: 100px; max-height: 80px; }
</style>
</head>
<body>

<h2>მონაცემების ძიება</h2>
<input type="text" id="searchInput" placeholder="გაიწერეთ სახელი, გვარი, ციფრი..." />

<table id="dataTable">
  <thead>
    <tr id="tableHeader"></tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
// მოდელი: ვადამონაცემები CSV ფაილიდან
const csvData = `სახელი,გვარი,ასაკი,ფოტო
გიორგი,ბევრია,30,images/giorgi1.jpg
მარიამ,მცირია,25,
ლაშა,საშინელი,NaN,images/lasha.jpg
ნინო,მცირია,27,images/nino.jpg
გურამი,საშინელი,40,
`;

// CSV-ს გადაყვანა ობიექტებად
function csvToArray(str, delimiter = ",") {
  const lines = str.trim().split("\n");
  const headers = lines[0].split(delimiter);
  return lines.slice(1).map(line => {
    const data = line.split(delimiter);
    let obj = {};
    headers.forEach((header, i) => {
      obj[header] = data[i] ? data[i].trim() : "";
    });
    return obj;
  });
}

const data = csvToArray(csvData);

// DOM ელემენტები
const searchInput = document.getElementById("searchInput");
const tableHeader = document.getElementById("tableHeader");
const tableBody = document.getElementById("tableBody");

// ცხრილის კოდი (სათაურის ჩათვლით)
function renderTable(rows) {
  tableBody.innerHTML = "";
  if (rows.length === 0) {
    tableBody.innerHTML = "<tr><td colspan='100%'>მონაცემი ვერ მოიძებნა</td></tr>";
    return;
  }
  
  // თუ ჯერ არ არის სათაური გაკეთებული
  if (tableHeader.children.length === 0) {
    for (const key in rows[0]) {
      tableHeader.innerHTML += `<th>${key}</th>`;
    }
  }
  
  rows.forEach(row => {
    const tr = document.createElement("tr");
    for (const key in row) {
      let value = row[key];
      if (value === "NaN" || value === "") {
        value = ""; // ცარიელი არაჩამოყვანილი
      }
      // თუ ველი არის ფოტო, გამოაჩინე სურათი
      if (key === "ფოტო" && value) {
        const imgTag = `<img src="${value}" alt="ფოტო" />`;
        tr.innerHTML += `<td>${imgTag}</td>`;
      } else {
        tr.innerHTML += `<td>${value}</td>`;
      }
    }
    tableBody.appendChild(tr);
  });
}

// საძიებო ფუნქცია
function filterData(query) {
  if (!query) return data;
  query = query.toLowerCase();
  // ფილტრაცია ყველა ველზე
  return data.filter(row => {
    return Object.values(row).some(value => 
      value && value.toLowerCase().includes(query)
    );
  });
}

// საძიებლის ივენთი
searchInput.addEventListener("input", e => {
  const filtered = filterData(e.target.value);
  renderTable(filtered);
});

// თავდაპირველი ცხრილი
renderTable(data);
</script>

</body>
</html>
