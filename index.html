<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8" />
<title>Excel მონაცემების ძიება CSV-დან</title>
<style>
  body { font-family: Arial; padding: 20px; }
  input { padding: 8px; width: 300px; margin-bottom: 15px; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  img { max-width: 100px; max-height: 80px; }
</style>
</head>
<body>

<h2>მონაცემების ძიება Excel-ის მიხედვით</h2>
<input type="text" id="searchInput" placeholder="გაიწერეთ სახელი, გვარი, ციფრი..." />

<table id="dataTable">
  <thead><tr id="tableHeader"></tr></thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
// აქ დაიმატე შენი CSV ფაილის URL (ფაილი უნდა იყოს შენს რეპოზიტორიაში)
const csvFilePath = 'data.csv';

// CSV-ს გადაყვანა ობიექტებში
function csvToArray(str, delimiter = ",") {
  const lines = str.trim().split("\n");
  const headers = lines[0].split(delimiter);
  return lines.slice(1).map(line => {
    const data = line.split(delimiter);
    let obj = {};
    headers.forEach((header, i) => {
      obj[header] = data[i] ? data[i].trim() : "";
    });
    return obj;
  });
}

// DOM ელემენტები
const searchInput = document.getElementById('searchInput');
const tableHeader = document.getElementById('tableHeader');
const tableBody = document.getElementById('tableBody');

let data = [];

// CSV-ის ჩატვირთვა და დანახვა
fetch(csvFilePath)
  .then(response => response.text())
  .then(text => {
    data = csvToArray(text);
    renderTable(data);
  })
  .catch(err => {
    tableBody.innerHTML = '<tr><td colspan="100%">მონაცემები ვერ ჩაიტვირთა</td></tr>';
  });

// ცხრილის გენერირება
function renderTable(rows) {
  tableBody.innerHTML = "";
  if (rows.length === 0) {
    tableBody.innerHTML = "<tr><td colspan='100%'>მონაცემი ვერ მოიძებნა</td></tr>";
    return;
  }
  
  if (tableHeader.children.length === 0 && rows.length > 0) {
    for (const key in rows[0]) {
      tableHeader.innerHTML += `<th>${key}</th>`;
    }
  }
  
  rows.forEach(row => {
    const tr = document.createElement('tr');
    for (const key in row) {
      let val = row[key];
      if(val === "NaN" || val === "") val = "";
      
      // თუ არის სურათი, გამოაჩინე img tag
      if(key.toLowerCase().includes('ფოტო') && val) {
        tr.innerHTML += `<td><img src="${val}" alt="ფოტო"/></td>`;
      } else {
        tr.innerHTML += `<td>${val}</td>`;
      }
    }
    tableBody.appendChild(tr);
  });
}

// საძიების ფუნქცია
function filterData(query) {
  if(!query) return data;
  query = query.toLowerCase();
  return data.filter(row => 
    Object.values(row).some(val => val && val.toLowerCase().includes(query))
  );
}

// საძიებო ველის ევენთი
searchInput.addEventListener('input', e => {
  const filtered = filterData(e.target.value);
  renderTable(filtered);
});
</script>

</body>
</html>
