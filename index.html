<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8">
  <title>Excel Viewer ძიებით</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input { margin-bottom: 10px; padding: 8px; width: 300px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; }
    img { max-width: 100px; max-height: 80px; }
  </style>
</head>
<body>

<h2>მონაცემების ძიება Excel-დან</h2>
<input type="text" id="searchInput" placeholder="სახელი, გვარი, რიცხვი..." />
<div id="tableContainer">იტვირთება...</div>

<script>
const EXCEL_FILE = 'data.xlsx';

function loadExcelFile(url) {
  fetch(url)
    .then(res => res.arrayBuffer())
    .then(ab => {
      const workbook = XLSX.read(ab, { type: 'array' });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const json = XLSX.utils.sheet_to_json(sheet, { defval: "" });
      renderTable(json);
    })
    .catch(err => {
      document.getElementById('tableContainer').innerText = 'ფაილის წაკითხვა ვერ მოხერხდა.';
      console.error(err);
    });
}

function renderTable(data) {
  const container = document.getElementById('tableContainer');
  const searchInput = document.getElementById('searchInput');

  if (!data.length) {
    container.innerHTML = 'ცხრილი ცარიელია.';
    return;
  }

  const headers = Object.keys(data[0]);
  let html = '<table><thead><tr>';
  headers.forEach(h => html += `<th>${h}</th>`);
  html += '</tr></thead><tbody id="tableBody">';

  data.forEach(row => {
    html += '<tr>';
    headers.forEach(h => {
      let cell = row[h];
      if (typeof cell === 'string' && (cell.endsWith('.jpg') || cell.endsWith('.png'))) {
        cell = `<img src="${cell}" alt="სურათი">`;
      }
      html += `<td>${cell}</td>`;
    });
    html += '</tr>';
  });

  html += '</tbody></table>';
  container.innerHTML = html;

  searchInput.addEventListener('input', () => {
    const filter = searchInput.value.toLowerCase();
    const tbody = document.getElementById('tableBody');
    const rows = tbody.querySelectorAll('tr');
    rows.forEach(row => {
      const text = row.innerText.toLowerCase();
      row.style.display = text.includes(filter) ? '' : 'none';
    });
  });
}

loadExcelFile(EXCEL_FILE);
</script>

</body>
</html>
